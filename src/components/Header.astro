---
import ToggleTheme from "./ToggleTheme.astro";
---

<header class="fixed top-0 left-0 right-0 z-50 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md border-b border-gray-200/20 dark:border-gray-700/20 transition-all duration-300">
  <div class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      
      <div class="flex-shrink-0">
        <a href="/" class="group flex items-center space-x-2">
          <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-xl transition-all duration-300 group-hover:scale-105">
            <span class="text-white font-bold text-lg">NC</span>
          </div>
          <span class="text-xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent">
            Portfolio
          </span>
        </a>
      </div>

      <nav class="hidden md:flex items-center space-x-8">
        <ul class="flex items-center space-x-8">
          <li>
            <a 
              href="/" 
              class="relative text-gray-700 dark:text-gray-300 hover:text-orange-600 dark:hover:text-orange-400 font-medium transition-colors duration-300 group"
            >
              Inicio
              <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-orange-500 to-orange-600 group-hover:w-full transition-all duration-300"></span>
            </a>
          </li>
          <li>
            <a 
              href="/"
              onclick="return setScroll('projects')"
              class="relative text-gray-700 dark:text-gray-300 hover:text-orange-600 dark:hover:text-orange-400 font-medium transition-colors duration-300 group"
            >
              Proyectos
              <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-orange-500 to-orange-600 group-hover:w-full transition-all duration-300"></span>
            </a>
          </li>
          <li>
            <a 
              href="/"
              onclick="return setScroll('contact')"
              class="relative text-gray-700 dark:text-gray-300 hover:text-orange-600 dark:hover:text-orange-400 font-medium transition-colors duration-300 group"
            >
              Contacto
              <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-orange-500 to-orange-600 group-hover:w-full transition-all duration-300"></span>
            </a>
          </li>
        </ul>
        
        <div class="flex items-center space-x-4">
          <ToggleTheme />
          <a 
            href="/"
            onclick="return setScroll('contact')"
            class="px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-semibold rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900"
          >
            Contáctame
          </a>
        </div>
      </nav>

      <div class="md:hidden flex items-center space-x-3">
        <ToggleTheme />
        <button
          id="menu-toggle"
          class="relative w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-500 transition-colors duration-200"
          aria-label="Abrir menú"
        >
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="w-5 h-5 flex flex-col justify-center space-y-1">
              <span class="block w-full h-0.5 bg-gray-600 dark:bg-gray-300 transition-all duration-300 origin-center" id="line1"></span>
              <span class="block w-full h-0.5 bg-gray-600 dark:bg-gray-300 transition-all duration-300" id="line2"></span>
              <span class="block w-full h-0.5 bg-gray-600 dark:bg-gray-300 transition-all duration-300 origin-center" id="line3"></span>
            </div>
          </div>
        </button>
      </div>
    </div>
  </div>
  <div 
    id="mobile-menu" 
    class="md:hidden absolute top-full left-0 right-0 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md border-b border-gray-200/20 dark:border-gray-700/20 transform -translate-y-full opacity-0 invisible transition-all duration-300 ease-out"
  >
    <div class="w-full max-w-7xl mx-auto px-4 py-6">
      <nav class="space-y-4">
        <a 
          href="/" 
          class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-orange-600 dark:hover:text-orange-400 hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-lg font-medium transition-all duration-200"
        >
          Inicio
        </a>
        <a 
          href="/"
          onclick="return setScroll('projects')"
          class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-orange-600 dark:hover:text-orange-400 hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-lg font-medium transition-all duration-200"
        >
          Proyectos
        </a>
        <a 
          href="/"
          onclick="return setScroll('contact')"
          class="block px-4 py-3 text-gray-700 dark:text-gray-300 hover:text-orange-600 dark:hover:text-orange-400 hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-lg font-medium transition-all duration-200"
        >
          Contacto
        </a>
        
        <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
          <a 
            href="/"
            onclick="return setScroll('contact')"
            class="block w-full px-4 py-3 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-semibold rounded-lg text-center transition-all duration-300 hover:scale-105"
          >
            Contáctame
          </a>
        </div>
      </nav>
    </div>
  </div>
</header>

<div class="h-16"></div>

<script is:inline>
function initMobileMenu() {
  const toggle = document.getElementById("menu-toggle");
  const menu = document.getElementById("mobile-menu");
  const line1 = document.getElementById("line1");
  const line2 = document.getElementById("line2");
  const line3 = document.getElementById("line3");
  
  let isOpen = false;

  toggle.addEventListener("click", () => {
    isOpen = !isOpen;
    
    if (isOpen) {
      // Abrir menú
      menu.classList.remove("-translate-y-full", "opacity-0", "invisible");
      menu.classList.add("translate-y-0", "opacity-100", "visible");
      
      // Animar hamburguesa a X
      line1.style.transform = "rotate(45deg) translate(2px, 2px)";
      line2.style.opacity = "0";
      line3.style.transform = "rotate(-45deg) translate(2px, -2px)";
    } else {
      // Cerrar menú
      menu.classList.remove("translate-y-0", "opacity-100", "visible");
      menu.classList.add("-translate-y-full", "opacity-0", "invisible");
      
      // Restaurar hamburguesa
      line1.style.transform = "rotate(0) translate(0, 0)";
      line2.style.opacity = "1";
      line3.style.transform = "rotate(0) translate(0, 0)";
    }
  });

  // Cerrar menú al hacer clic en un enlace
  const mobileLinks = menu.querySelectorAll("a");
  mobileLinks.forEach(link => {
    link.addEventListener("click", () => {
      if (isOpen) {
        toggle.click();
      }
    });
  });

  // Cerrar menú al hacer scroll
  let lastScrollY = window.scrollY;
  window.addEventListener("scroll", () => {
    if (isOpen && window.scrollY > lastScrollY) {
      toggle.click();
    }
    lastScrollY = window.scrollY;
  });
}

document.addEventListener("astro:page-load", initMobileMenu);

function setScroll(target) {
  localStorage.setItem("scrollTarget", target);
  return true;
}
</script>